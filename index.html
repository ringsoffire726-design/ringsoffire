<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ring's of Fire - Esports League</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .font-tech { font-family: 'Rajdhani', sans-serif; }

        /* --- Animations & Effects --- */
        @keyframes gradient-shift { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }
        @keyframes grid-flow {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(40px); }
        }
        @keyframes float-slow { 
            0%, 100% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 0.3; } 
            33% { transform: translate(30px, -50px) scale(1.1) rotate(5deg); opacity: 0.5; } 
            66% { transform: translate(-20px, 20px) scale(0.9) rotate(-5deg); opacity: 0.3; } 
        }
        @keyframes cyber-pulse {
            0% { box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(6, 182, 212, 0); }
            100% { box-shadow: 0 0 0 0 rgba(6, 182, 212, 0); }
        }
        @keyframes fire-pulse {
            0% { box-shadow: 0 0 5px rgba(234, 88, 12, 0.2), inset 0 0 10px rgba(234, 88, 12, 0.1); border-color: rgba(234, 88, 12, 0.4); }
            50% { box-shadow: 0 0 25px rgba(220, 38, 38, 0.6), inset 0 0 20px rgba(220, 38, 38, 0.3); border-color: rgba(249, 115, 22, 0.8); }
            100% { box-shadow: 0 0 5px rgba(234, 88, 12, 0.2), inset 0 0 10px rgba(234, 88, 12, 0.1); border-color: rgba(234, 88, 12, 0.4); }
        }
        @keyframes tab-enter {
            from { opacity: 0; transform: translateY(10px) scale(0.98); filter: blur(4px); }
            to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }
        @keyframes glitch-skew {
            0% { transform: skew(0deg); }
            10% { transform: skew(-2deg); }
            20% { transform: skew(2deg); }
            30% { transform: skew(0deg); }
            100% { transform: skew(0deg); }
        }
        @keyframes glitch-anim-1 {
            0% { clip: rect(20px, 9999px, 10px, 0); }
            100% { clip: rect(80px, 9999px, 100px, 0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip: rect(50px, 9999px, 20px, 0); }
            100% { clip: rect(10px, 9999px, 80px, 0); }
        }
        @keyframes rise {
            0% { transform: translateY(120vh) scale(0); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-20vh) scale(1); opacity: 0; }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scroll-left { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        @keyframes load-bar { 0% { width: 0; } 100% { width: 100%; } }

        /* Utility Classes */
        .animate-gradient-shift { background-size: 200% 200%; animation: gradient-shift 3s linear infinite; }
        .animate-grid-flow { animation: grid-flow 2s linear infinite; }
        .animate-float-slow { animation: float-slow 8s ease-in-out infinite alternate; }
        .animate-cyber-pulse { animation: cyber-pulse 2s infinite; }
        .animate-fire-pulse { animation: fire-pulse 2s infinite; }
        .animate-tab-enter { animation: tab-enter 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fade-in-down { animation: fadeInDown 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-scroll-left { animation: scroll-left 40s linear infinite; }
        .animate-load-bar { animation: load-bar 2s ease-in-out forwards; }
        
        /* Cyber Grid Background */
        .bg-cyber-grid {
            background-image: linear-gradient(rgba(6, 182, 212, 0.15) 1px, transparent 1px),
            linear-gradient(90deg, rgba(6, 182, 212, 0.15) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Glitch Text Utility */
        .glitch-text {
            position: relative;
            animation: glitch-skew 4s infinite linear alternate-reverse;
        }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
        }
        .glitch-text::before {
            left: 2px;
            text-shadow: -1px 0 #00ffff;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim-1 3s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            left: -2px;
            text-shadow: -1px 0 #ff00ff;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim-2 2.5s infinite linear alternate-reverse;
        }

        /* UI Elements */
        .glass-panel { background: rgba(2, 6, 23, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        .glass-card { 
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.6) 0%, rgba(2, 6, 23, 0.9) 100%);
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative;
            overflow: hidden;
        }
        .glass-card:hover { 
            transform: translateY(-5px) scale(1.01); 
            border-color: rgba(6, 182, 212, 0.4); 
            box-shadow: 0 10px 40px -10px rgba(6, 182, 212, 0.2), 0 0 20px rgba(6, 182, 212, 0.1) inset; 
        }
        .neon-text { text-shadow: 0 0 10px rgba(6, 182, 212, 0.6), 0 0 20px rgba(6, 182, 212, 0.4); }
        .neon-text-gold { text-shadow: 0 0 10px rgba(234, 179, 8, 0.6), 0 0 20px rgba(234, 179, 8, 0.4); }
        .neon-text-fire { text-shadow: 0 0 10px rgba(249, 115, 22, 0.8), 0 0 20px rgba(220, 38, 38, 0.6); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(2, 6, 23, 0.5); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(56, 189, 248, 0.3); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(6, 182, 212, 0.6); }
        
        input, select, button { font-size: 16px !important; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js';
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, doc, setDoc, onSnapshot, serverTimestamp, arrayUnion, deleteDoc, increment, query, where, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js';
        import { Trophy, Gamepad2, Users, Calendar, CheckCircle, Plus, Trash2, LogOut, Shield, User, X, Lock, Key, Edit3, Crosshair, Award, History, Zap, QrCode, AlertTriangle, Check, RefreshCcw, Flame, Timer, AlertOctagon, Menu, Info, Pause, PlayCircle, Wallet, CreditCard, Smartphone, ShieldCheck, Loader2, ChevronRight, Megaphone, ScrollText, List, Coins, Save, MinusCircle, Pencil, Instagram, Mail, LogIn, UserPlus, Bell, Send, Filter, MessageSquare, Share2, Star } from 'https://esm.sh/lucide-react@0.292.0';

        // --- CONFIG ---
        const firebaseConfig = {
          apiKey: "AIzaSyA6h78d692c8B86bY9VdStoHxw-RXgKfBE",
          authDomain: "rings-of-fire-2.firebaseapp.com",
          projectId: "rings-of-fire-2",
          storageBucket: "rings-of-fire-2.firebasestorage.app",
          messagingSenderId: "53125558154",
          appId: "1:53125558154:web:4fa473df9d422ad48de273",
          measurementId: "G-JVJJB1SWHF"
        };

        let app, analytics, auth, db;
        let initError = null;
        try {
            app = initializeApp(firebaseConfig);
            analytics = getAnalytics(app);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase Init Error:", e);
            initError = e;
        }

        const getTournamentCollection = () => db ? collection(db, 'tournaments') : null;
        const getTournamentDoc = (id) => db ? doc(db, 'tournaments', id) : null;
        const getSettingsDoc = (docName) => db ? doc(db, 'appSettings', docName) : null;
        const getNotificationsCollection = () => db ? collection(db, 'notifications') : null;

        const sendSystemNotification = async (target, title, message, type = 'info') => {
            try {
                const ref = getNotificationsCollection();
                if(ref) await addDoc(ref, { target, title, message, type, createdAt: serverTimestamp(), readBy: [] });
            } catch (e) { console.error(e); }
        };

        const formatDate = (iso) => new Date(iso).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
        const formatTime = (iso) => new Date(iso).toLocaleTimeString('en-IN', { hour: 'numeric', minute: '2-digit', hour12: true });

        // --- COMPONENTS ---
        const CountdownTimer = ({ targetDate }) => {
          const calculate = () => {
            const diff = +new Date(targetDate) - +new Date();
            if (diff > 0) return { d: Math.floor(diff / (86400000)), h: Math.floor((diff / 3600000) % 24), m: Math.floor((diff / 60000) % 60) };
            return {};
          };
          const [timeLeft, setTimeLeft] = useState(calculate());
          useEffect(() => { const t = setInterval(() => setTimeLeft(calculate()), 1000); return () => clearInterval(t); }, [targetDate]);
          const pad = (n) => String(n).padStart(2, '0');
          if (Object.keys(timeLeft).length === 0) return <span className="text-emerald-400 font-bold animate-pulse font-tech tracking-widest">LIVE</span>;
          return <div className={`flex items-center gap-1 font-mono text-xs md:text-sm font-bold ${!timeLeft.d ? 'text-yellow-400' : 'text-cyan-400'}`}>{timeLeft.d > 0 && <span>{timeLeft.d}d</span>}<span>{pad(timeLeft.h)}h</span><span>{pad(timeLeft.m)}m</span></div>;
        };

        const PaymentTimer = ({ initialSeconds, onExpire }) => {
            const [seconds, setSeconds] = useState(initialSeconds);
            useEffect(() => { if (seconds > 0) { const t = setTimeout(() => setSeconds(s => s - 1), 1000); return () => clearTimeout(t); } else { onExpire(); } }, [seconds]);
            return <span className="font-mono text-yellow-400">{Math.floor(seconds / 60)}:{String(seconds % 60).padStart(2, '0')}</span>;
        };

        const NewsTicker = ({ newsItems }) => {
            const items = newsItems && newsItems.length ? newsItems : ["Welcome to Ring's of Fire! üèÜ", "Register now! üöÄ"];
            return (
                <div className="bg-slate-950/80 border-b border-cyan-500/20 h-8 flex items-center overflow-hidden relative z-50 backdrop-blur-sm">
                    <div className="absolute left-0 z-10 bg-slate-950 px-2 h-full flex items-center text-cyan-400 font-bold text-xs font-mono border-r border-cyan-500/30"><Megaphone size={14} className="mr-2 animate-pulse"/> SYSTEM NEWS</div>
                    <div className="whitespace-nowrap animate-scroll-left flex gap-12 items-center text-xs text-slate-300 font-medium w-full font-tech tracking-wide">
                        {items.map((item, i) => <span key={i} className="flex items-center gap-2"><span className="w-1.5 h-1.5 bg-cyan-500 rounded-full inline-block animate-pulse"></span> {item}</span>)}
                        {items.map((item, i) => <span key={`d-${i}`} className="flex items-center gap-2"><span className="w-1.5 h-1.5 bg-cyan-500 rounded-full inline-block animate-pulse"></span> {item}</span>)}
                    </div>
                </div>
            );
        };

        const NotificationCenter = ({ notifications, role }) => {
            const [isOpen, setIsOpen] = useState(false);
            return (
                <div className="relative z-50">
                    <button onClick={() => setIsOpen(!isOpen)} className="relative p-2 text-slate-400 hover:text-white transition-colors group"><Bell size={20} className="group-hover:text-cyan-400 transition-colors" />{notifications.length > 0 && (<span className="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-slate-950 animate-ping"></span>)}</button>
                    {isOpen && (
                        <>
                            <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)}></div>
                            <div className="absolute right-0 mt-2 w-72 md:w-80 bg-slate-900 border border-cyan-500/30 rounded-xl shadow-[0_0_50px_-10px_rgba(6,182,212,0.2)] z-50 overflow-hidden animate-fade-in-up backdrop-blur-xl">
                                <div className="p-3 border-b border-cyan-500/20 flex justify-between items-center bg-slate-950/80"><h4 className="font-bold text-white text-sm font-tech tracking-wide">SYSTEM LOGS</h4><span className="text-[10px] bg-cyan-500/20 text-cyan-400 px-2 py-0.5 rounded-full font-mono">{notifications.length} NEW</span></div>
                                <div className="max-h-64 overflow-y-auto custom-scrollbar">
                                    {notifications.length === 0 ? (<div className="p-6 text-center text-slate-500 text-xs italic">No new alerts.</div>) : (notifications.map((n, i) => (
                                        <div key={i} className={`p-3 border-b border-slate-800 hover:bg-slate-800/50 transition-colors ${n.type === 'warning' ? 'border-l-2 border-l-yellow-500' : 'border-l-2 border-l-emerald-500'}`}><div className="flex justify-between items-start mb-1"><span className="font-bold text-white text-xs">{n.title}</span><span className="text-[9px] text-slate-500">{n.createdAt ? formatTime(n.createdAt.toDate()) : 'Now'}</span></div><p className="text-xs text-slate-400 leading-snug">{n.message}</p></div>
                                    )))}
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        const ParticleBackground = () => {
          const particles = useMemo(() => Array.from({ length: 25 }).map((_, i) => ({ 
              id: i, 
              left: Math.random() * 100 + '%', 
              size: Math.random() * 3 + 1 + 'px', 
              duration: Math.random() * 10 + 10 + 's', 
              delay: -(Math.random() * 20) + 's',
              color: Math.random() > 0.5 ? '#06b6d4' : '#8b5cf6' // Cyan or Violet
          })), []);
          
          return (
            <div className="fixed inset-0 -z-10 overflow-hidden bg-slate-950">
                {/* Deep Animated Gradient Background */}
                <div className="absolute inset-0 bg-gradient-to-br from-[#020617] via-[#0f172a] to-[#1e1b4b] animate-gradient-shift opacity-90"></div>
                
                {/* Moving Cyber Grid at Bottom */}
                <div className="absolute bottom-0 left-[-50%] right-[-50%] h-[60vh] bg-cyber-grid animate-grid-flow opacity-20 [mask-image:linear-gradient(to_top,black,transparent)]"></div>

                {/* Floating Plasma Orbs */}
                <div className="absolute top-[10%] left-[20%] w-[30vw] h-[30vw] bg-cyan-500/20 rounded-full blur-[100px] animate-float-slow mix-blend-screen"></div>
                <div className="absolute bottom-[10%] right-[10%] w-[35vw] h-[35vw] bg-violet-600/20 rounded-full blur-[120px] animate-float-slow mix-blend-screen" style={{animationDelay: '-5s'}}></div>

                {/* Rising Digital Embers */}
                {particles.map(p => (
                    <div key={p.id} className="absolute bottom-0 rounded-full" 
                         style={{ 
                             left: p.left, 
                             width: p.size, 
                             height: p.size, 
                             backgroundColor: p.color,
                             boxShadow: `0 0 ${parseInt(p.size)*2}px ${p.color}`,
                             animation: `rise ${p.duration} linear infinite`, 
                             animationDelay: p.delay 
                         }} 
                    />
                ))}

                {/* Texture Overlays */}
                <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.04] mix-blend-overlay pointer-events-none"></div>
                <div className="absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-slate-950 opacity-60 pointer-events-none"></div>
            </div>
          );
        };

        function PlayerAuthModal({ onClose, onLogin, showNotification }) {
          const [isSignUp, setIsSignUp] = useState(false);
          const [email, setEmail] = useState('');
          const [password, setPassword] = useState('');
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState('');
          const [welcomeSequence, setWelcomeSequence] = useState(false);

          const handleAuth = async (e) => {
            e.preventDefault(); setLoading(true); setError('');
            try {
                if (isSignUp) { await createUserWithEmailAndPassword(auth, email, password); } 
                else { await signInWithEmailAndPassword(auth, email, password); }
                
                setLoading(false);
                setWelcomeSequence(true);
                setTimeout(() => {
                    onLogin();
                }, 3500);

            } catch (err) { 
                setError(err.message); 
                setLoading(false);
            } 
          };

          if (welcomeSequence) {
              return (
                <div className="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-slate-950/95 backdrop-blur-2xl animate-fade-in overflow-hidden">
                    <div className="absolute inset-0 pointer-events-none">
                        <div className="absolute top-0 left-0 w-full h-1 bg-cyan-500/50 animate-scanline"></div>
                    </div>
                    
                    <div className="relative z-10 text-center">
                        <div className="mb-8 relative inline-block">
                            <div className="absolute inset-0 bg-cyan-500 rounded-full blur-[50px] opacity-40 animate-pulse"></div>
                            <Gamepad2 size={80} className="text-cyan-400 relative z-10 animate-bounce" />
                        </div>
                        
                        <h2 className="text-4xl md:text-6xl font-black text-white font-tech tracking-tighter mb-4 glitch-text" data-text="ACCESS GRANTED">ACCESS GRANTED</h2>
                        
                        <div className="w-64 h-1 bg-slate-800 rounded-full mx-auto overflow-hidden relative mb-2">
                            <div className="h-full bg-gradient-to-r from-cyan-500 to-blue-600 animate-load-bar"></div>
                        </div>
                        
                        <p className="text-cyan-500 font-mono text-sm animate-pulse">INITIALIZING BATTLE SYSTEMS...</p>
                        
                        <div className="mt-8 text-slate-400 text-xs font-mono">
                            ID: {email.split('@')[0].toUpperCase()}<br/>
                            STATUS: ONLINE
                        </div>
                    </div>
                </div>
              );
          }

          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md animate-fade-in">
              <div className="glass-panel p-6 rounded-2xl w-full max-w-sm relative border border-slate-700/50">
                <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={20}/></button>
                <div className="text-center mb-6"><h3 className="text-lg font-bold text-white font-tech uppercase">Player Access</h3></div>
                <form onSubmit={handleAuth} className="space-y-3">
                  <input type="email" placeholder="Email" className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white text-sm focus:border-cyan-500 outline-none transition-all" value={email} onChange={e => setEmail(e.target.value)} required />
                  <input type="password" placeholder="Password" className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white text-sm focus:border-cyan-500 outline-none transition-all" value={password} onChange={e => setPassword(e.target.value)} required />
                  {error && <div className="text-red-400 text-xs text-center font-bold animate-pulse">{error}</div>}
                  <button disabled={loading} type="submit" className="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-3 rounded-xl text-sm shadow-lg shadow-cyan-500/20 transition-all hover:scale-105 active:scale-95 flex items-center justify-center gap-2">
                      {loading ? <Loader2 size={18} className="animate-spin"/> : (isSignUp ? 'Create Account' : 'Login')}
                  </button>
                </form>
                <div className="mt-4 text-center"><button onClick={() => setIsSignUp(!isSignUp)} className="text-xs text-slate-400 hover:text-cyan-400 transition-colors">{isSignUp ? "Have account? Login" : "New? Create Account"}</button></div>
              </div>
            </div>
          );
        }

        function AdminLoginModal({ onClose, onLogin, showNotification }) {
          const [creds, setCreds] = useState({ id: '', password: '' });
          const [error, setError] = useState('');
          const handleLogin = async (e) => { 
              e.preventDefault(); 
              if (creds.id === 'blackboom172' && creds.password === '1517') { 
                  try { if (!auth.currentUser) await signInAnonymously(auth); showNotification('Access Granted.'); onLogin(); } 
                  catch (err) { setError('Auth Error'); }
              } else { setError('Access Denied'); } 
          };
          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md animate-fade-in">
              <div className="glass-panel p-6 rounded-2xl w-full max-w-sm border border-slate-700/50">
                <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={20}/></button>
                <h3 className="text-lg font-bold text-white font-tech uppercase text-center mb-6">Organizer Access</h3>
                <form onSubmit={handleLogin} className="space-y-3">
                  <input type="text" placeholder="ID" className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white text-sm" value={creds.id} onChange={e => setCreds({...creds, id: e.target.value})} />
                  <input type="password" placeholder="Passcode" className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white text-sm" value={creds.password} onChange={e => setCreds({...creds, password: e.target.value})} />
                  {error && <div className="text-red-400 text-xs text-center">{error}</div>}
                  <button type="submit" className="w-full bg-gradient-to-r from-cyan-600 to-blue-600 text-white font-bold py-3 rounded-xl text-sm">Authenticate</button>
                </form>
              </div>
            </div>
          );
        }

        function PaymentModal({ tournament, onClose, userId, showNotification, onLoginRequest }) {
          const [step, setStep] = useState(1);
          const [loading, setLoading] = useState(false);
          const req = tournament.format === 'Squad' ? 4 : tournament.format === 'Duo' ? 2 : 1;
          const [form, setForm] = useState({ name: '', ign: '', txn: '', team: Array(req-1).fill(''), upiId: '', upiName: '' });
          const [autoCloseTimer, setAutoCloseTimer] = useState(5);

          useEffect(() => {
            let interval;
            if (step === 3) { interval = setInterval(() => { setAutoCloseTimer((prev) => { if (prev <= 1) { clearInterval(interval); onClose(); return 0; } return prev - 1; }); }, 1000); }
            return () => clearInterval(interval);
          }, [step, onClose]);

          const handleJoin = async (e, isFree = false) => {
              e.preventDefault(); setLoading(true); 
              const isDuplicate = tournament.participants?.some(p => p.userId === userId);
              if (isDuplicate) { showNotification("Already joined!", "warning"); onClose(); setLoading(false); return; }
              
              try {
                const docRef = getTournamentDoc(tournament.id);
                if (docRef) { 
                    await updateDoc(docRef, { 
                        filledSlots: increment(req), 
                        participants: arrayUnion({ userId, name: form.name, inGameName: form.ign, teammates: form.team, paymentId: isFree ? 'FREE' : form.txn, paymentVerified: isFree, joinedAt: new Date().toISOString(), upiId: form.upiId, upiName: form.upiName }) 
                    }); 
                }
                if (isFree) { showNotification("Joined!"); onClose(); } 
                else { setStep(3); showNotification("Submitted"); await sendSystemNotification('admin', 'New Join Request', `Verify: ${form.txn}`, 'warning'); }
              } catch(e) { console.error(e); alert("Error"); } finally { setLoading(false); }
          };
          
          if (!userId) return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-xl animate-fade-in">
              <div className="glass-panel rounded-3xl w-full max-w-md p-8 text-center border border-slate-700">
                  <button onClick={onClose} className="absolute top-4 right-4 text-slate-400"><X size={24}/></button>
                  <h3 className="text-2xl font-black text-white mb-2">Login Required</h3>
                  <button onClick={onLoginRequest} className="w-full bg-cyan-600 text-white font-bold py-3 rounded-xl mb-3">Login / Sign Up</button>
              </div>
            </div>
          );

          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-xl animate-fade-in">
              <div className="glass-panel rounded-3xl w-full max-w-lg border border-slate-700 shadow-2xl overflow-hidden relative h-[85vh] max-h-[800px] flex flex-col">
                {step !== 3 && <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 z-10"><X size={24}/></button>}
                {step === 1 ? (
                  <div className="p-6 overflow-y-auto custom-scrollbar flex-1">
                      <h3 className="text-xl font-bold text-white mb-6">Registration</h3>
                      <form onSubmit={e => { e.preventDefault(); if (Number(tournament.entryFee) === 0) { handleJoin(e, true); } else { setStep(2); } }} className="space-y-4">
                        <input required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white text-sm" placeholder="Your Name" value={form.name} onChange={e=>setForm({...form, name:e.target.value})} />
                        <input required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white text-sm" placeholder="In-Game Name" value={form.ign} onChange={e=>setForm({...form, ign:e.target.value})} />
                        {req > 1 && form.team.map((t,i)=><input key={i} required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white text-sm" placeholder={`Teammate ${i+1}`} value={t} onChange={ev=>{const n=[...form.team]; n[i]=ev.target.value; setForm({...form, team:n})}} />)}
                        <div className="pt-4 border-t border-slate-800"><h4 className="text-sm font-bold text-cyan-400 mb-2">Payout Info</h4><input required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white text-sm mb-2" placeholder="UPI ID" value={form.upiId} onChange={e=>setForm({...form, upiId:e.target.value})} /><input required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white text-sm" placeholder="Reg. Name" value={form.upiName} onChange={e=>setForm({...form, upiName:e.target.value})} /></div>
                        <button disabled={loading} className="w-full bg-cyan-600 text-white font-bold py-3 rounded-xl mt-2 text-sm">{loading ? 'Loading...' : 'Next'}</button>
                      </form>
                  </div>
                ) : step === 2 ? (
                  <div className="flex-1 flex flex-col">
                      <div className="bg-white p-4 flex justify-between items-center border-b"><span className="text-slate-800 font-bold">Pay ‚Çπ{tournament.entryFee}</span><PaymentTimer initialSeconds={300} onExpire={onClose}/></div>
                      <div className="p-6 overflow-y-auto bg-slate-50 flex-1">
                          <div className="mb-4"><a href={`upi://pay?pa=7042368784@pthdfc&pn=Fardeen&am=${tournament.entryFee}`} className="block bg-blue-600 text-white p-3 rounded text-center font-bold">Pay via UPI App</a></div>
                          <div className="bg-white p-4 rounded border mb-4 text-center"><img src={`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(`upi://pay?pa=7042368784@pthdfc&pn=Fardeen&am=${tournament.entryFee}`)}`} className="mx-auto w-32 h-32"/></div>
                          <form onSubmit={(e) => handleJoin(e, false)}><input required className="w-full border p-3 rounded mb-2 text-black" placeholder="UTR / Ref No." value={form.txn} onChange={e=>setForm({...form, txn:e.target.value})} /><button disabled={loading} className="w-full bg-slate-800 text-white font-bold py-3 rounded">{loading ? 'Verifying...' : 'Submit Payment'}</button></form>
                      </div>
                  </div>
                ) : (
                  <div className="p-8 text-center flex-1 flex flex-col justify-center">
                      <h3 className="text-2xl font-bold text-white mb-2">Submitted!</h3>
                      <p className="text-slate-400 mb-4">Admin is verifying.</p>
                      <button onClick={onClose} className="w-full bg-slate-800 text-white py-3 rounded font-bold">Close ({autoCloseTimer}s)</button>
                  </div>
                )}
              </div>
            </div>
          );
        }

        function CreateTournamentForm({ onComplete, userId, showNotification }) {
          const [loading, setLoading] = useState(false);
          const [form, setForm] = useState({ game: 'Free Fire', format: 'Solo', title: '', map: 'Bermuda', date: '', time: '', entryFee: 0, prizePool: 0, totalSlots: 48, rules: "1. No Hacking\n2. No Teaming" });
          
          const handleSubmit = async (e) => {
            e.preventDefault(); setLoading(true);
            try {
              const collectionRef = getTournamentCollection();
              await addDoc(collectionRef, { ...form, entryFee: Number(form.entryFee), prizePool: Number(form.prizePool), totalSlots: Number(form.totalSlots), filledSlots: 0, participants: [], hostId: userId || 'unknown', status: 'upcoming', registrationOpen: true, createdAt: serverTimestamp(), dateTime: new Date(`${form.date}T${form.time}`).toISOString() });
              onComplete();
            } catch (error) { console.error(error); showNotification("Failed", "error"); } finally { setLoading(false); }
          };

          return (
            <div className="glass-panel p-6 rounded-2xl border border-slate-700 max-w-3xl mx-auto">
              <h3 className="text-xl font-bold text-white mb-6">New Tournament</h3>
              <form onSubmit={handleSubmit} className="space-y-4">
                <div className="grid grid-cols-3 gap-4">
                  <select className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" value={form.game} onChange={e => setForm({...form, game: e.target.value})}><option>Free Fire</option><option>PUBG Mobile</option><option>BGMI</option></select>
                  <select className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" value={form.format} onChange={e => setForm({...form, format: e.target.value})}><option>Solo</option><option>Duo</option><option>Squad</option></select>
                  <input className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Map" value={form.map} onChange={e => setForm({...form, map: e.target.value})} />
                </div>
                <input className="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Title" value={form.title} onChange={e => setForm({...form, title: e.target.value})} />
                <div className="grid grid-cols-2 gap-4"><input type="date" className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" value={form.date} onChange={e => setForm({...form, date: e.target.value})} /><input type="time" className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" value={form.time} onChange={e => setForm({...form, time: e.target.value})} /></div>
                <div className="grid grid-cols-3 gap-4"><input type="number" className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Fee" value={form.entryFee} onChange={e => setForm({...form, entryFee: e.target.value})} /><input type="number" className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Prize" value={form.prizePool} onChange={e => setForm({...form, prizePool: e.target.value})} /><input type="number" className="bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm" placeholder="Slots" value={form.totalSlots} onChange={e => setForm({...form, totalSlots: e.target.value})} /></div>
                <textarea className="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm h-24" value={form.rules} onChange={e => setForm({...form, rules: e.target.value})} />
                <button disabled={loading} className="w-full bg-cyan-600 text-white font-bold py-3 rounded-xl">{loading ? 'Launching...' : 'Launch'}</button>
              </form>
            </div>
          );
        }

        function NewsEditorModal({ onClose, initialNews, showNotification }) {
            const [items, setItems] = useState(initialNews || []);
            const [newItem, setNewItem] = useState('');
            const addItem = (e) => { e.preventDefault(); if (newItem.trim()) { setItems([...items, newItem.trim()]); setNewItem(''); } };
            const removeItem = (index) => { setItems(items.filter((_, i) => i !== index)); };
            const saveNews = async () => {
                try {
                    const newsDoc = getSettingsDoc('news');
                    if(newsDoc) { await setDoc(newsDoc, { items }); showNotification("News Updated Successfully!"); onClose(); }
                } catch(e) { console.error(e); showNotification("Failed to save news", "error"); }
            };
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md animate-fade-in">
                  <div className="glass-panel p-6 rounded-2xl w-full max-w-lg relative border border-slate-700">
                    <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={20}/></button><h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><Megaphone size={20} className="text-yellow-400"/> Edit News Ticker</h3>
                    <div className="space-y-3 mb-6"><form onSubmit={addItem} className="flex gap-2"><input className="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm outline-none focus:border-cyan-500" placeholder="Type new announcement..." value={newItem} onChange={e=>setNewItem(e.target.value)}/><button className="bg-cyan-600 hover:bg-cyan-500 text-white p-2 rounded-lg"><Plus size={20}/></button></form><div className="max-h-60 overflow-y-auto custom-scrollbar space-y-2 bg-slate-900/50 p-2 rounded-lg">{items.length === 0 && <div className="text-slate-500 text-xs text-center py-4">No news items.</div>}{items.map((item, i) => (<div key={i} className="flex justify-between items-center bg-slate-800 p-2 rounded border border-slate-700"><span className="text-sm text-slate-200">{item}</span><button onClick={()=>removeItem(i)} className="text-red-400 hover:text-red-300 p-1"><MinusCircle size={16}/></button></div>))}</div></div>
                    <button onClick={saveNews} className="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded-xl text-sm flex justify-center items-center gap-2"><Save size={16}/> Save Changes</button>
                  </div>
                </div>
            );
        }

        function BroadcastModal({ onClose, showNotification }) {
            const [msg, setMsg] = useState('');
            const [title, setTitle] = useState('');
            const [sending, setSending] = useState(false);
            const handleSend = async (e) => { e.preventDefault(); setSending(true); try { await sendSystemNotification('all', title, msg, 'info'); showNotification('Broadcast Sent Successfully'); onClose(); } catch(e) { console.error(e); showNotification('Failed to send', 'error'); } finally { setSending(false); } };
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-md animate-fade-in">
                  <div className="glass-panel p-6 rounded-2xl w-full max-w-lg relative border border-slate-700">
                    <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white"><X size={20}/></button><h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><Bell size={20} className="text-cyan-400"/> Send Broadcast</h3><p className="text-xs text-slate-400 mb-4">This message will be sent to ALL registered users instantly.</p>
                    <form onSubmit={handleSend} className="space-y-4"><input required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm outline-none focus:border-cyan-500" placeholder="Title (e.g. Server Maintenance)" value={title} onChange={e=>setTitle(e.target.value)}/><textarea required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm outline-none focus:border-cyan-500 h-24 resize-none" placeholder="Message body..." value={msg} onChange={e=>setMsg(e.target.value)}/><button disabled={sending} className="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl text-sm flex justify-center items-center gap-2">{sending ? 'Sending...' : 'Send Broadcast'}</button></form>
                  </div>
                </div>
            );
        }

        function AdminTournamentCard({ data, showNotification }) {
          const [expanded, setExpanded] = useState(false);
          const [editing, setEditing] = useState(false);
          const [room, setRoom] = useState({ id: data.roomId || '', pass: data.roomPassword || '' });
          const [winnerModal, setWinnerModal] = useState(false);
          const [winnerName, setWinnerName] = useState('');

          const updateRoom = async (e) => { e.preventDefault(); const docRef = getTournamentDoc(data.id); await updateDoc(docRef, { roomId: room.id, roomPassword: room.pass }); setEditing(false); showNotification("Room Updated"); };
          const verifyUser = async (uid) => { const docRef = getTournamentDoc(data.id); await updateDoc(docRef, { participants: data.participants.map(p => p.userId === uid ? { ...p, paymentVerified: true } : p) }); };
          const removeUser = async (uid) => { const docRef = getTournamentDoc(data.id); await updateDoc(docRef, { participants: data.participants.filter(p => p.userId !== uid), filledSlots: increment(-1) }); };
          const declareWinner = async () => { const docRef = getTournamentDoc(data.id); await updateDoc(docRef, { status: 'completed', winner: winnerName }); setWinnerModal(false); showNotification("Closed"); };
          const deleteT = async () => { if(confirm("Delete?")) await deleteDoc(getTournamentDoc(data.id)); };

          return (
            <div className={`glass-card rounded-2xl overflow-hidden ${data.status === 'completed' ? 'opacity-60' : ''}`}>
              <div className="p-4 flex flex-col md:flex-row gap-4 justify-between items-center">
                <div className="flex-1">
                  <div className="flex gap-2 mb-2"><span className="bg-emerald-900 text-emerald-400 text-[10px] px-2 py-1 rounded">{data.game}</span><span className="bg-blue-900 text-blue-400 text-[10px] px-2 py-1 rounded">{data.format}</span></div>
                  <h3 className="font-bold text-white">{data.title}</h3>
                  <div className="text-xs text-slate-400 mt-1 flex gap-4"><span>{formatDate(data.dateTime)} {formatTime(data.dateTime)}</span><span>{data.participants?.length}/{data.totalSlots} Filled</span></div>
                  {data.winner && <div className="mt-2 text-yellow-400 text-xs font-bold">Winner: {data.winner}</div>}
                </div>
                <div className="flex gap-2">
                    <button onClick={() => setWinnerModal(true)} className="p-2 bg-yellow-900/50 text-yellow-400 rounded"><Award size={18}/></button>
                    <button onClick={() => setExpanded(!expanded)} className="p-2 bg-slate-800 text-slate-400 rounded"><Users size={18}/></button>
                    <button onClick={deleteT} className="p-2 bg-red-900/50 text-red-400 rounded"><Trash2 size={18}/></button>
                </div>
              </div>
              {expanded && (
                <div className="bg-slate-900/50 p-4 border-t border-slate-800">
                    <div className="flex justify-between mb-2"><h4 className="text-xs font-bold text-white">Room Info</h4><button onClick={() => setEditing(!editing)} className="text-cyan-400"><Edit3 size={14}/></button></div>
                    {editing ? <form onSubmit={updateRoom} className="flex gap-2 mb-4"><input className="bg-slate-950 border border-slate-700 rounded p-1 text-xs text-white w-24" placeholder="ID" value={room.id} onChange={e=>setRoom({...room, id:e.target.value})}/><input className="bg-slate-950 border border-slate-700 rounded p-1 text-xs text-white w-24" placeholder="Pass" value={room.pass} onChange={e=>setRoom({...room, pass:e.target.value})}/><button className="bg-emerald-600 text-white px-2 rounded text-xs">Save</button></form> : <div className="text-xs text-slate-400 mb-4">ID: {data.roomId || '--'} | Pass: {data.roomPassword || '--'}</div>}
                    <h4 className="text-xs font-bold text-white mb-2">Players</h4>
                    <div className="space-y-1 max-h-64 overflow-y-auto custom-scrollbar">
                        {data.participants?.map((p,i) => (
                            <div key={i} className="bg-slate-950/50 p-3 rounded border border-white/5 mb-2">
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <div className="text-sm font-bold text-white">{p.inGameName}</div>
                                        <div className="text-[10px] text-slate-500">Name: {p.name}</div>
                                    </div>
                                     <div className="flex gap-2">
                                        {!p.paymentVerified && <button onClick={()=>verifyUser(p.userId)} className="text-emerald-400 bg-emerald-500/10 p-1 rounded hover:bg-emerald-500/20"><Check size={14}/></button>}
                                        <button onClick={()=>removeUser(p.userId)} className="text-red-400 bg-red-500/10 p-1 rounded hover:bg-red-500/20"><Trash2 size={14}/></button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-2 text-[10px] bg-slate-900 p-2 rounded border border-white/5">
                                    <div><span className="text-slate-500 block font-bold uppercase">UPI ID</span><span className="text-cyan-400 select-all">{p.upiId || 'N/A'}</span></div>
                                    <div><span className="text-slate-500 block font-bold uppercase">Reg. Name</span><span className="text-cyan-400">{p.upiName || 'N/A'}</span></div>
                                    <div className="col-span-2"><span className="text-slate-500 block font-bold uppercase">Txn ID</span><span className="text-white font-mono select-all">{p.paymentId}</span></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
              )}
              {winnerModal && (
                  <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur">
                      <div className="bg-slate-900 p-6 rounded-xl w-64 border border-slate-700">
                          <h4 className="text-white font-bold mb-4">Declare Winner</h4>
                          <input className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm mb-4" placeholder="Winner Name" value={winnerName} onChange={e=>setWinnerName(e.target.value)} />
                          <button onClick={declareWinner} className="w-full bg-yellow-600 text-white font-bold py-2 rounded text-sm mb-2">Confirm</button>
                          <button onClick={()=>setWinnerModal(false)} className="w-full bg-slate-800 text-slate-400 py-2 rounded text-sm">Cancel</button>
                      </div>
                  </div>
              )}
            </div>
          );
        }

        // --- Extracted Constants for PlayerTournamentCard ---
        const DefaultRules = () => (
            <>
                <p>1. Teaming with other squads results in immediate DQ.</p>
                <p>2. Hackers will be permanently banned.</p>
                <p>3. Room ID/Pass shared 10 mins before start.</p>
                <p>4. Screenshot your result for disputes.</p>
                <div className="bg-slate-800 p-2 rounded mt-2">
                    <div className="font-bold text-slate-300 mb-1">Points System</div>
                    <div className="grid grid-cols-2 gap-2"><span>Booyah: 12pts</span><span>2nd: 9pts</span><span>Kill: 1pt</span></div>
                </div>
            </>
        );

        function PlayerTournamentCard({ t, joined, verified, slotsLeft, percentFilled, isFull, setSelected }) {
            const [activeTab, setActiveTab] = useState('overview');
            const [now, setNow] = useState(Date.now());
            useEffect(() => { const i = setInterval(() => setNow(Date.now()), 30000); return () => clearInterval(i); }, []);
            
            const isPast = t.status === 'completed';
            const roomLocked = (new Date(t.dateTime).getTime() - now) > 900000;
            
            const didWin = isPast && joined && (t.winner === joined.inGameName || t.winner === joined.name);

            return (
                <div className={`glass-card rounded-2xl overflow-hidden flex flex-col transition-all duration-300 hover:-translate-y-1 ${didWin ? 'border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.3)]' : !isPast ? 'border-white/5 hover:border-orange-500/50 hover:shadow-[0_0_30px_rgba(234,88,12,0.2)] animate-fire-pulse' : 'border-white/5 opacity-75 hover:opacity-100'}`}>
                    <div className={`h-36 p-5 relative flex flex-col justify-end ${didWin ? 'bg-gradient-to-t from-yellow-900/40 to-slate-900' : isPast ? 'bg-slate-900/50' : 'bg-gradient-to-br from-orange-900/40 to-red-900/20'}`}>
                        <div className="absolute top-0 left-0 w-full h-full bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10"></div>
                        <div className="flex justify-between relative z-10 mb-auto"><span className="bg-slate-950/50 border border-white/10 text-[10px] font-bold px-2 py-1 rounded text-white uppercase tracking-wider backdrop-blur-md">{t.game}</span><span className="text-yellow-400 font-black text-base flex items-center gap-1 drop-shadow-md"><Trophy size={16}/> ‚Çπ{t.prizePool}</span></div>
                        <h3 className="text-xl font-black text-white mt-2 truncate font-tech tracking-wide uppercase drop-shadow-lg">{t.title}</h3>
                        {!isPast && <div className="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 to-red-600 shadow-[0_0_10px_rgba(249,115,22,0.8)]"></div>}
                        {didWin && <div className="absolute top-4 right-4 text-yellow-400 animate-bounce drop-shadow-[0_0_10px_rgba(234,179,8,0.8)]"><Trophy size={28}/></div>}
                    </div>
                    <div className="flex border-b border-white/5 bg-slate-900/40 backdrop-blur-md">
                        {['overview', 'players', 'prizes', 'rules'].map(tab => (
                            <button key={tab} onClick={()=>setActiveTab(tab)} className={`flex-1 py-3 text-[10px] uppercase font-bold tracking-widest transition-all duration-300 ${activeTab===tab ? 'text-orange-400 border-b-2 border-orange-500 bg-orange-500/10' : 'text-slate-500 hover:text-slate-300 hover:bg-white/5'}`}>{tab}</button>
                        ))}
                    </div>
                    <div className="p-5 flex-1 flex flex-col gap-4 text-xs text-slate-300 bg-slate-900/20 backdrop-blur-sm relative overflow-hidden">
                        <div className="absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent to-slate-950/80"></div>
                        <div className="relative z-10 key={activeTab} animate-tab-enter">
                        {activeTab === 'overview' && (
                            <div className="space-y-5">
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-slate-950/60 border border-white/5 p-2.5 rounded-lg flex items-center gap-2 text-slate-300"><Calendar size={14} className="text-cyan-400"/> <div>{formatDate(t.dateTime)}<div className="text-[10px] text-slate-500">{formatTime(t.dateTime)}</div></div></div>
                                    <div className="bg-slate-950/60 border border-white/5 p-2.5 rounded-lg flex items-center justify-center">{isPast ? <span className="text-yellow-500 font-bold tracking-wider">COMPLETED</span> : <CountdownTimer targetDate={t.dateTime}/>}</div>
                                </div>
                                <div>
                                    <div className="flex justify-between text-[10px] font-bold mb-1.5 uppercase tracking-wider"><span className="text-slate-500">Registration Status</span><span className={isFull ? "text-red-400" : "text-emerald-400"}>{slotsLeft} Slots Open</span></div>
                                    <div className="w-full bg-slate-950 h-1.5 rounded-full overflow-hidden border border-white/5"><div className={`h-full transition-all duration-1000 ease-out ${isFull ? 'bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]' : 'bg-gradient-to-r from-cyan-500 to-blue-500 shadow-[0_0_10px_rgba(6,182,212,0.5)]'}`} style={{ width: `${percentFilled}%` }}></div></div>
                                </div>
                                {joined && !isPast && (
                                    <div className={`border rounded-lg p-3 relative overflow-hidden ${verified ? 'bg-emerald-900/20 border-emerald-500/30' : 'bg-yellow-900/20 border-yellow-500/30'}`}>
                                        {!verified ? <div className="text-yellow-400 font-bold flex gap-2 items-center justify-center animate-pulse"><AlertTriangle size={16}/> VERIFICATION PENDING</div> : 
                                         roomLocked ? <div className="text-center text-slate-400 flex flex-col items-center gap-1"><Lock size={20} className="text-cyan-400 mb-1"/> <span className="text-[10px] uppercase tracking-wider">Room Locked</span></div> : 
                                         <div className="space-y-2">
                                             <div className="flex justify-between items-center border-b border-white/10 pb-1"><span className="text-[10px] uppercase text-slate-500 font-bold">Room ID</span><span className="text-white font-mono bg-slate-950 px-2 py-0.5 rounded select-all">{t.roomId}</span></div>
                                             <div className="flex justify-between items-center"><span className="text-[10px] uppercase text-slate-500 font-bold">Password</span><span className="text-white font-mono bg-slate-950 px-2 py-0.5 rounded select-all">{t.roomPassword}</span></div>
                                         </div>}
                                    </div>
                                )}
                            </div>
                        )}
                        {activeTab === 'players' && <div className="space-y-2 max-h-40 overflow-y-auto custom-scrollbar pr-1">{t.participants?.length ? t.participants.map((p,i)=><div key={i} className="flex justify-between items-center bg-slate-950/40 border border-white/5 p-2.5 rounded-lg hover:bg-slate-800/50 transition-colors"><span className="font-bold text-slate-200 text-xs flex items-center gap-2"><span className="w-5 h-5 bg-slate-800 rounded-full flex items-center justify-center text-[9px] text-slate-500">{i+1}</span> {p.inGameName}</span></div>) : <div className="text-center text-slate-500 py-8 italic border border-dashed border-white/10 rounded-lg">Lobby Empty</div>}</div>}
                        {activeTab === 'prizes' && <div className="bg-gradient-to-br from-yellow-900/20 to-slate-900 p-5 rounded-xl border border-yellow-500/20 text-center relative overflow-hidden"><div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10"></div><Trophy size={32} className="mx-auto text-yellow-400 mb-3 drop-shadow-[0_0_15px_rgba(234,179,8,0.6)]"/><div className="text-2xl font-black text-white font-tech tracking-wider">‚Çπ{t.prizePool}</div><div className="text-yellow-500/80 text-[10px] uppercase tracking-widest mt-1 font-bold">Winner Takes All</div></div>}
                        {activeTab === 'rules' && <div className="text-slate-400 whitespace-pre-wrap leading-relaxed bg-slate-950/30 p-3 rounded-lg border border-white/5 text-[11px]">{t.rules || <DefaultRules/>}</div>}
                        </div>
                        
                        <div className="mt-auto pt-4 border-t border-white/10 flex justify-between items-center relative z-20">
                            <div className="flex flex-col"><span className="text-[10px] text-slate-500 uppercase font-bold tracking-wider">Entry Fee</span><span className="text-white font-black text-lg">{t.entryFee === 0 ? <span className="text-emerald-400">FREE</span> : `‚Çπ${t.entryFee}`}</span></div>
                            {isPast ? 
                                (didWin ? 
                                    <div className="flex-1 text-right"><div className="text-[10px] text-yellow-500 font-bold uppercase mb-1 tracking-wider">Victory</div><div className="bg-gradient-to-r from-yellow-600 to-yellow-500 text-slate-900 px-4 py-1.5 rounded-full font-black text-xs inline-flex items-center gap-2 shadow-[0_0_15px_rgba(234,179,8,0.4)]"><Trophy size={12}/> +‚Çπ{t.prizePool}</div></div> 
                                    : 
                                    <div className="text-right"><div className="text-[10px] text-slate-500 uppercase font-bold tracking-wider">Champion</div><div className="text-yellow-400 font-bold flex items-center gap-1 neon-text-gold"><Trophy size={14}/> {t.winner || 'TBA'}</div></div>) 
                             : 
                             joined ? <button disabled className="bg-emerald-900/20 border border-emerald-500/30 text-emerald-400 px-6 py-2.5 rounded-lg font-bold text-xs uppercase tracking-wider flex items-center gap-2"><CheckCircle size={14}/> Joined</button> : 
                             !t.registrationOpen ? <button disabled className="bg-slate-800 text-slate-500 px-6 py-2.5 rounded-lg font-bold text-xs uppercase tracking-wider cursor-not-allowed">Paused</button> :
                             isFull ? <button disabled className="bg-red-900/20 border border-red-500/30 text-red-400 px-6 py-2.5 rounded-lg font-bold text-xs uppercase tracking-wider cursor-not-allowed">Full</button> :
                             <button onClick={()=>setSelected(t)} className="bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white px-8 py-2.5 rounded-lg font-black text-xs uppercase tracking-widest shadow-lg shadow-orange-500/20 hover:shadow-orange-500/40 hover:scale-105 active:scale-95 transition-all duration-300">Join</button>}
                        </div>
                    </div>
                </div>
            );
        }

        function RoleSelection({ onSelect, showNotification, authError, onGuestLogin }) {
          const [showAdmin, setShowAdmin] = useState(false);
          return (
            <div className="flex flex-col items-center justify-center min-h-[60vh] py-10 relative z-10">
              {authError && <div className="bg-red-500/20 border border-red-500 text-red-200 px-4 py-2 rounded mb-6 text-sm animate-bounce">{authError}</div>}
              {showAdmin && <AdminLoginModal onClose={()=>setShowAdmin(false)} onLogin={()=>onSelect('admin')} showNotification={showNotification}/>}
              
              <div className="text-center mb-20 relative">
                  <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-cyan-500/10 rounded-full blur-[100px] -z-10"></div>
                  <div className="inline-block mb-6 relative group cursor-default">
                      <div className="absolute inset-0 bg-cyan-500 blur-[40px] opacity-20 group-hover:opacity-40 transition-opacity duration-500"></div>
                      <Flame size={80} className="text-cyan-500 relative z-10 filter drop-shadow-[0_0_15px_rgba(6,182,212,0.8)] animate-pulse"/>
                  </div>
                  <h2 className="text-7xl md:text-9xl font-black text-white mb-4 tracking-tighter font-tech glitch-text leading-none" data-text="THE FUTURE">THE FUTURE</h2>
                  <div className="h-1 w-24 bg-gradient-to-r from-transparent via-cyan-500 to-transparent mx-auto mb-4"></div>
                  <p className="text-slate-400 text-lg font-light tracking-[0.2em] uppercase">Step into the fire. Compete for glory.</p>
              </div>

              <div className="grid md:grid-cols-2 gap-10 w-full max-w-5xl px-4">
                  {/* Player Card */}
                  <button onClick={onGuestLogin} className="group relative h-96 rounded-[2.5rem] overflow-hidden transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_60px_-10px_rgba(6,182,212,0.3)] border border-white/10 bg-slate-900/80 backdrop-blur-xl">
                      {/* Animated Gradient Border */}
                      <div className="absolute inset-0 p-[2px] rounded-[2.5rem] bg-gradient-to-br from-cyan-500 via-blue-600 to-transparent opacity-50 group-hover:opacity-100 transition-opacity duration-500 animate-gradient-shift" style={{mask: 'linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)', maskComposite: 'exclude'}}></div>
                      
                      {/* Inner Backgrounds */}
                      <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay"></div>
                      <div className="absolute inset-0 bg-gradient-to-b from-cyan-900/10 via-slate-900/50 to-slate-950 opacity-80"></div>
                      
                      {/* Floating Elements */}
                      <div className="absolute -right-12 -top-12 w-64 h-64 bg-cyan-500/10 rounded-full blur-[80px] group-hover:bg-cyan-400/20 transition-colors duration-500"></div>
                      
                      {/* Scanner Effect */}
                      <div className="absolute inset-0 w-full h-[2px] bg-cyan-400/50 blur-sm -translate-y-full group-hover:translate-y-[400px] transition-transform duration-[1.5s] ease-in-out delay-100"></div>

                      <div className="relative z-10 h-full flex flex-col justify-end p-10 text-left">
                          <div className="absolute top-8 right-8 p-5 bg-slate-950/80 rounded-2xl border border-white/10 group-hover:border-cyan-500/60 group-hover:scale-110 transition-all duration-500 shadow-[0_0_30px_-5px_rgba(6,182,212,0.2)] group-hover:shadow-[0_0_30px_rgba(6,182,212,0.5)]">
                              <Gamepad2 size={48} className="text-slate-400 group-hover:text-cyan-400 transition-colors duration-300"/>
                          </div>
                          
                          <div className="space-y-3 transform translate-y-2 group-hover:translate-y-0 transition-transform duration-500">
                              <div className="flex items-center gap-3 mb-2">
                                  <div className="h-[2px] w-8 bg-cyan-500 group-hover:w-16 transition-all duration-500"></div>
                                  <span className="text-cyan-500 text-xs font-bold uppercase tracking-widest">Access Granted</span>
                              </div>
                              <h3 className="text-5xl font-black text-white font-tech italic leading-none group-hover:text-cyan-50 transition-colors drop-shadow-lg">PLAYER<br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">ZONE</span></h3>
                              <p className="text-slate-400 font-medium text-sm leading-relaxed group-hover:text-slate-300 transition-colors max-w-[80%]">Join the battlefield. Verify your skills. Claim victory.</p>
                          </div>
                      </div>
                  </button>

                  {/* Organizer Card */}
                  <button onClick={()=>setShowAdmin(true)} className="group relative h-96 rounded-[2.5rem] overflow-hidden transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_0_60px_-10px_rgba(139,92,246,0.3)] border border-white/10 bg-slate-900/80 backdrop-blur-xl">
                      {/* Animated Gradient Border */}
                      <div className="absolute inset-0 p-[2px] rounded-[2.5rem] bg-gradient-to-br from-violet-600 via-fuchsia-600 to-transparent opacity-50 group-hover:opacity-100 transition-opacity duration-500 animate-gradient-shift" style={{mask: 'linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)', maskComposite: 'exclude'}}></div>

                      {/* Inner Backgrounds */}
                      <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay"></div>
                      <div className="absolute inset-0 bg-gradient-to-b from-violet-900/10 via-slate-900/50 to-slate-950 opacity-80"></div>

                      {/* Floating Elements */}
                      <div className="absolute -left-12 -top-12 w-64 h-64 bg-violet-500/10 rounded-full blur-[80px] group-hover:bg-violet-400/20 transition-colors duration-500"></div>

                      {/* Scanner Effect */}
                      <div className="absolute inset-0 w-full h-[2px] bg-violet-400/50 blur-sm -translate-y-full group-hover:translate-y-[400px] transition-transform duration-[1.5s] ease-in-out delay-100"></div>

                      <div className="relative z-10 h-full flex flex-col justify-end p-10 text-left">
                          <div className="absolute top-8 right-8 p-5 bg-slate-950/80 rounded-2xl border border-white/10 group-hover:border-violet-500/60 group-hover:scale-110 transition-all duration-500 shadow-[0_0_30px_-5px_rgba(139,92,246,0.2)] group-hover:shadow-[0_0_30px_rgba(139,92,246,0.5)]">
                              <Shield size={48} className="text-slate-400 group-hover:text-violet-400 transition-colors duration-300"/>
                          </div>
                          
                          <div className="space-y-3 transform translate-y-2 group-hover:translate-y-0 transition-transform duration-500">
                              <div className="flex items-center gap-3 mb-2">
                                  <div className="h-[2px] w-8 bg-violet-500 group-hover:w-16 transition-all duration-500"></div>
                                  <span className="text-violet-500 text-xs font-bold uppercase tracking-widest">Restricted Area</span>
                              </div>
                              <h3 className="text-5xl font-black text-white font-tech italic leading-none group-hover:text-violet-50 transition-colors drop-shadow-lg">ADMIN<br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-violet-400 to-fuchsia-500">CONSOLE</span></h3>
                              <p className="text-slate-400 font-medium text-sm leading-relaxed group-hover:text-slate-300 transition-colors max-w-[80%]">Control the arena. Manage brackets. Crown champions.</p>
                          </div>
                      </div>
                  </button>
              </div>
            </div>
          );
        }

        function AdminPanel({ tournaments, showNotification, userId, news }) {
            const [view, setView] = useState('list');
            const [showNews, setShowNews] = useState(false);
            const [showBroadcast, setShowBroadcast] = useState(false);
            return (
                <div>
                    {showNews && <NewsEditorModal onClose={()=>setShowNews(false)} initialNews={news} showNotification={showNotification} />}
                    {showBroadcast && <BroadcastModal onClose={()=>setShowBroadcast(false)} showNotification={showNotification}/>}
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl font-black text-white font-tech tracking-wide flex items-center gap-2"><Shield className="text-cyan-500"/> DASHBOARD</h2>
                        <div className="flex gap-2">
                            {view === 'list' && (
                                <>
                                <button onClick={()=>setShowBroadcast(true)} className="bg-indigo-600 text-white px-4 py-2 rounded font-bold text-xs hover:scale-105 transition-transform">Broadcast</button>
                                <button onClick={()=>setShowNews(true)} className="bg-slate-800 text-white px-4 py-2 rounded font-bold text-xs hover:scale-105 transition-transform border border-slate-600">News</button>
                                </>
                            )}
                            <button onClick={()=>setView(view==='list'?'create':'list')} className="bg-cyan-600 text-white px-4 py-2 rounded font-bold text-xs hover:scale-105 transition-transform">{view==='list' ? '+ Create' : 'Back'}</button>
                        </div>
                    </div>
                    {view === 'create' ? <CreateTournamentForm onComplete={()=>{setView('list'); showNotification("Created!");}} userId={userId} showNotification={showNotification}/> : 
                     <div className="grid gap-4 animate-fade-in-up">{tournaments.map(t => <AdminTournamentCard key={t.id} data={t} showNotification={showNotification}/>)}</div>}
                </div>
            );
        }

        function PlayerPanel({ tournaments, showNotification, userId, targetTournamentId, onLoginRequest }) {
            const [view, setView] = useState('home');
            const [selected, setSelected] = useState(null);
            const [gameFilter, setGameFilter] = useState('All');
            const [tab, setTab] = useState('upcoming'); // 'upcoming', 'past', 'career'

            const filtered = tournaments.filter(t => {
                if (tab === 'career') return t.participants?.some(p => p.userId === userId);
                if (tab === 'upcoming' && t.status === 'completed') return false;
                if (tab === 'past' && t.status !== 'completed') return false;
                if (gameFilter !== 'All' && t.game !== gameFilter) return false;
                if (targetTournamentId && t.id !== targetTournamentId) return false;
                return true;
            });

            // Calculate total winnings for 'career' tab
            const myMatches = tournaments.filter(t => t.participants?.some(p => p.userId === userId));
            const totalWinnings = myMatches.reduce((acc, t) => {
                if(t.status === 'completed' && t.winner) {
                    const me = t.participants.find(p => p.userId === userId);
                    if(me && (t.winner === me.inGameName || t.winner === me.name)) return acc + Number(t.prizePool);
                }
                return acc;
            }, 0);

            return (
                <div>
                    <div className="flex justify-between items-end mb-8">
                        <h2 className="text-4xl font-black text-white font-tech tracking-tighter">BATTLE<span className="text-cyan-500">GROUNDS</span></h2>
                        <div className="flex gap-4 text-sm font-bold text-slate-500">
                            <button onClick={()=>setTab('upcoming')} className={tab==='upcoming'?'text-cyan-400 underline decoration-2 underline-offset-4':''}>LIVE</button>
                            <button onClick={()=>setTab('past')} className={tab==='past'?'text-yellow-400 underline decoration-2 underline-offset-4':''}>RESULTS</button>
                            {userId && <button onClick={()=>setTab('career')} className={tab==='career'?'text-emerald-400 underline decoration-2 underline-offset-4':''}>MY CAREER</button>}
                        </div>
                    </div>
                    
                    {tab === 'career' && (
                        <div className="mb-8 animate-fade-in">
                            <div className="bg-gradient-to-r from-emerald-900/40 to-slate-900 p-6 rounded-2xl border border-emerald-500/30 flex items-center justify-between shadow-[0_0_30px_rgba(16,185,129,0.2)]">
                                <div>
                                    <div className="text-emerald-400 font-bold text-sm uppercase tracking-wider mb-1">Total Earnings</div>
                                    <div className="text-4xl font-black text-white font-tech">‚Çπ{totalWinnings}</div>
                                </div>
                                <div className="text-right">
                                    <div className="text-slate-400 text-xs uppercase tracking-wider">Matches Played</div>
                                    <div className="text-2xl font-bold text-white">{myMatches.length}</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {tab !== 'career' && (
                        <div className="flex gap-2 overflow-x-auto pb-4 mb-2 custom-scrollbar">
                            {['All','Free Fire','BGMI','COD Mobile'].map(g => <button key={g} onClick={()=>setGameFilter(g)} className={`px-4 py-1 rounded-full border text-xs font-bold whitespace-nowrap ${gameFilter===g?'bg-cyan-500/20 border-cyan-500 text-cyan-400 shadow-[0_0_10px_rgba(6,182,212,0.3)]':'bg-slate-900 border-slate-800 text-slate-500'}`}>{g}</button>)}
                        </div>
                    )}

                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in-up">
                        {filtered.length === 0 ? <div className="col-span-full text-center py-20 text-slate-500 italic border border-dashed border-slate-800 rounded-xl">No tournaments found.</div> : 
                         filtered.map(t => {
                             const joined = t.participants?.find(p => p.userId === userId);
                             const filled = (t.participants?.length || 0) * (t.format === 'Squad' ? 4 : t.format === 'Duo' ? 2 : 1);
                             const slotsLeft = Math.max(0, t.totalSlots - filled);
                             return <PlayerTournamentCard key={t.id} t={t} joined={joined} verified={joined?.paymentVerified} slotsLeft={slotsLeft} percentFilled={(filled/t.totalSlots)*100} isFull={slotsLeft===0} setSelected={setSelected}/>
                         })}
                    </div>
                    {selected && <PaymentModal tournament={selected} onClose={()=>setSelected(null)} userId={userId} showNotification={showNotification} onLoginRequest={onLoginRequest}/>}
                </div>
            );
        }

        function App() {
            const [user, setUser] = useState(null);
            const [role, setRole] = useState(null);
            const [tournaments, setTournaments] = useState([]);
            const [news, setNews] = useState([]);
            const [notifications, setNotifications] = useState([]);
            const [loading, setLoading] = useState(true);
            const [notification, setNotification] = useState(null);
            const [authError, setAuthError] = useState(null);
            const [showAuth, setShowAuth] = useState(false);
            const [targetId, setTargetId] = useState(null);

            useEffect(() => {
                if (!app) { setAuthError("Firebase Error"); setLoading(false); return; }
                return onAuthStateChanged(auth, u => { setUser(u); if(u && !u.isAnonymous) setRole('player'); setLoading(false); });
            }, []);

            useEffect(() => {
                const tid = new URLSearchParams(window.location.search).get('tournament_id');
                if (tid) { setTargetId(tid); if(!user && !role) setRole('guest'); }
            }, [user, role]);

            useEffect(() => {
                if((!user && role !== 'guest' && role !== 'admin') || !db) return;
                const unsubT = onSnapshot(getTournamentCollection(), s => setTournaments(s.docs.map(d => ({id:d.id, ...d.data()})).sort((a,b) => new Date(a.dateTime) - new Date(b.dateTime))));
                const unsubN = onSnapshot(getSettingsDoc('news'), d => d.exists() && setNews(d.data().items));
                const q = query(getNotificationsCollection(), where('target', 'in', ['all', role === 'admin' ? 'admin' : (user?.uid || 'guest')]), limit(20));
                const unsubNotif = onSnapshot(q, s => {
                    const notes = s.docs.map(d => ({id:d.id, ...d.data()})).sort((a,b) => b.createdAt?.seconds - a.createdAt?.seconds);
                    if(notes.length > 0 && notifications.length > 0 && notes[0].id !== notifications[0].id) showNotif(notes[0].title);
                    setNotifications(notes);
                });
                return () => { unsubT(); unsubN(); unsubNotif(); };
            }, [user, role]);

            const showNotif = (msg, type='success') => { setNotification({message:msg, type}); setTimeout(()=>setNotification(null), 3000); };
            const handleLogout = () => signOut(auth).then(() => { setRole(null); setUser(null); });

            if (loading) return <div className="min-h-screen bg-slate-950 flex items-center justify-center text-cyan-500"><Loader2 size={48} className="animate-spin"/></div>;

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-sans selection:bg-cyan-500 selection:text-slate-950 overflow-x-hidden pb-20 relative">
                    <div className="fixed inset-0 z-0 pointer-events-none bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5 mix-blend-overlay"></div>
                    <ParticleBackground />
                    <NewsTicker newsItems={news} />
                    {showAuth && <PlayerAuthModal onClose={()=>setShowAuth(false)} onLogin={()=>{setShowAuth(false); setRole('player');}} showNotification={showNotif}/>}
                    {notification && <div className="fixed top-20 right-6 z-[100] bg-slate-800 border border-cyan-500/50 p-4 rounded-xl shadow-2xl animate-fade-in-down flex gap-3 items-center"><div className="bg-cyan-500/20 p-2 rounded-full text-cyan-400"><Bell size={18}/></div><span className="font-bold text-sm">{notification.message}</span></div>}
                    
                    <header className="glass-panel sticky top-0 z-40 border-b border-white/5 backdrop-blur-xl">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
                            <div className="flex items-center gap-3"><div className="bg-gradient-to-br from-cyan-600 to-blue-700 p-2 rounded-lg shadow-lg shadow-cyan-500/20"><Flame size={20} className="text-white"/></div><div><h1 className="text-xl font-black tracking-tighter italic text-white glitch-text" data-text="RING'S OF FIRE">RING'S OF FIRE</h1></div></div>
                            {(role || user) && <div className="flex gap-4 items-center"><NotificationCenter notifications={notifications}/><button onClick={handleLogout} className="text-slate-400 hover:text-white"><LogOut size={20}/></button></div>}
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-8 relative z-10">
                        {!role ? <RoleSelection onSelect={setRole} showNotification={showNotif} authError={authError} onGuestLogin={()=>setShowAuth(true)}/> : 
                         role === 'admin' ? <AdminPanel tournaments={tournaments} showNotification={showNotif} userId={user?.uid} news={news} /> : 
                         <PlayerPanel tournaments={tournaments} showNotification={showNotif} userId={user?.uid} targetTournamentId={targetId} onLoginRequest={()=>setShowAuth(true)}/>}
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
